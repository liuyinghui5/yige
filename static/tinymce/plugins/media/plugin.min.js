/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.5.1 (2020-10-01)
 */
(function(){var fa=tinymce.util.Tools.resolve("tinymce.PluginManager"),p=function(){p=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};return p.apply(this,arguments)},ha=function(){},t=function(a){return function(){return a}},y=t(!1),F=t(!0),B=function(){return G},G=function(){var a=function(d){return d.isNone()},b=function(d){return d()},c=function(d){return d};return{fold:function(d,e){return d()},is:y,isSome:y,isNone:F,getOr:c,getOrThunk:b,getOrDie:function(d){throw Error(d||"error: getOrDie called on none.");},getOrNull:t(null),getOrUndefined:t(void 0),or:c,orThunk:b,map:B,each:ha,bind:B,exists:y,forall:F,filter:B,equals:a,equals_:a,toArray:function(){return[]},toString:t("none()")}}(),H=function(a){var b=t(a),c=function(){return e},d=function(f){return f(a)},e={fold:function(f,h){return h(a)},is:function(f){return a===f},isSome:F,isNone:y,getOr:b,getOrThunk:b,getOrDie:b,getOrNull:b,getOrUndefined:b,or:c,orThunk:c,map:function(f){return H(f(a))},each:function(f){f(a)},bind:d,exists:d,forall:d,filter:function(f){return f(a)?e:G},toArray:function(){return[a]},toString:function(){return"some("+a+")"},equals:function(f){return f.is(a)},equals_:function(f,h){return f.fold(y,function(k){return h(a,k)})}};return e},u={some:H,none:B,from:function(a){return null===a||void 0===a?G:H(a)}},v=function(a){return function(b){var c=typeof b;return(null===b?"null":"object"===c&&(Array.prototype.isPrototypeOf(b)||b.constructor&&"Array"===b.constructor.name)?"array":"object"===c&&(String.prototype.isPrototypeOf(b)||b.constructor&&"String"===b.constructor.name)?"string":c)===a}},ia=v("string"),N=v("object"),ja=v("array"),ka=Array.prototype.push,O=function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c)},la=function(a){for(var b=[],c=0,d=a.length;c<d;++c){if(!ja(a[c]))throw Error("Arr.flatten item "+c+" was not an array, input: "+a);ka.apply(b,a[c])}return b},I=function(a){var b=a;return{get:function(){return b},set:function(c){b=c}}},ma=Object.keys,J=Object.hasOwnProperty,na=function(a,b){for(var c=ma(a),d=0,e=c.length;d<e;d++){var f=c[d];b(a[f],f)}},n=function(a,b){return J.call(a,b)?u.from(a[b]):u.none()},w=function(a){return a.getParam("media_scripts")},r=tinymce.util.Tools.resolve("tinymce.util.Tools");v=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils");var K=tinymce.util.Tools.resolve("tinymce.html.SaxParser"),L=function(a,b){if(a)for(var c=0;c<a.length;c++)if(-1!==b.indexOf(a[c].filter))return a[c]},oa=v.DOM,P=function(a){return a.replace(/px$/,"")},C=function(a,b){var c=I(!1),d={};K({validate:!1,allow_conditional_comments:!0,start:function(e,f){if(!c.get())if(J.call(f.map,"data-ephox-embed-iri"))c.set(!0),e=(e=f.map.style)?oa.parseStyle(e):{},d={type:"ephox-embed-iri",source:f.map["data-ephox-embed-iri"],altsource:"",poster:"",width:n(e,"max-width").map(P).getOr(""),height:n(e,"max-height").map(P).getOr("")};else{d.source||"param"!==e||(d.source=f.map.movie);if("iframe"===e||"object"===e||"embed"===e||"video"===e||"audio"===e)d.type||(d.type=e),d=r.extend(f.map,d);if("script"===e){var h=L(a,f.map.src);if(!h)return;d={type:"script",source:f.map.src,width:String(h.width),height:String(h.height)}}"source"===e&&(d.source?d.altsource||(d.altsource=f.map.src):d.source=f.map.src);"img"!==e||d.poster||(d.poster=f.map.src)}}}).parse(b);d.source=d.source||d.src||d.data;d.altsource=d.altsource||"";d.poster=d.poster||"";return d},Q=function(a){return(a={mp3:"audio/mpeg",m4a:"audio/x-m4a",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"}[a.toLowerCase().split(".").pop()])?a:""},R=tinymce.util.Tools.resolve("tinymce.html.Schema"),S=tinymce.util.Tools.resolve("tinymce.html.Writer"),T=v.DOM,U=function(a){return/^[0-9.]+$/.test(a)?a+"px":a},q=function(a,b){na(b,function(c,d){c=""+c;if(a.map[d])for(var e=a.length;e--;){var f=a[e];f.name===d&&(c?(a.map[d]=c,f.value=c):(delete a.map[d],a.splice(e,1)))}else c&&(a.push({name:d,value:c}),a.map[d]=c)})},x=["source","altsource"],M=function(a,b,c){var d=S(),e=I(!1),f=0,h;K({validate:!1,allow_conditional_comments:!0,comment:function(k){d.comment(k)},cdata:function(k){d.cdata(k)},text:function(k,g){d.text(k,g)},start:function(k,g,l){if(!e.get())if(J.call(g.map,"data-ephox-embed-iri")){e.set(!0);var m=g.map.style;m=m?T.parseStyle(m):{};m["max-width"]=U(b.width);m["max-height"]=U(b.height);q(g,{style:T.serializeStyle(m)})}else{switch(k){case"video":case"object":case"embed":case"img":case"iframe":void 0!==b.height&&void 0!==b.width&&q(g,{width:b.width,height:b.height})}if(c)switch(k){case"video":q(g,{poster:b.poster,src:""});b.altsource&&q(g,{src:""});break;case"iframe":q(g,{src:b.source});break;case"source":if(2>f&&(q(g,{src:b[x[f]],type:b[x[f]+"mime"]}),!b[x[f]]))return;f++;break;case"img":if(!b.poster)return;h=!0}}d.start(k,g,l)},end:function(k){if(!e.get()){if("video"===k&&c)for(var g=0;2>g;g++)if(b[x[g]]){var l=[];l.map={};f<=g&&(q(l,{src:b[x[g]],type:b[x[g]+"mime"]}),d.start("source",l,!0))}b.poster&&"object"===k&&c&&!h&&(g=[],g.map={},q(g,{src:b.poster,width:b.width,height:b.height}),d.start("img",g,!0))}d.end(k)}},R({})).parse(a);return d.getContent()},pa=[{regex:/youtu\.be\/([\w\-_\?&=.]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$2?$4",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\?&=\-_]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?title=0&amp;byline=0",allowFullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],qa=function(a){return(a=a.match(/^(https?:\/\/|www\.)(.+)$/i))&&1<a.length?"www."===a[1]?"https://":a[1]:"https://"},ra=function(a,b){var c=qa(b),d=a.regex.exec(b),e=c+a.url;a=function(f){e=e.replace("$"+f,function(){return d[f]?d[f]:""})};for(b=0;b<d.length;b++)a(b);return e.replace(/\?$/,"")},sa=function(a){var b=pa.filter(function(c){return c.regex.test(a)});return 0<b.length?r.extend({},b[0],{url:ra(b[0],a)}):null},ta=function(a){var b='<object data="'+a.source+'" width="'+a.width+'" height="'+a.height+'" type="application/x-shockwave-flash">';a.poster&&(b+='<img src="'+a.poster+'" width="'+a.width+'" height="'+a.height+'" />');return b+"</object>"},ua=function(a,b){return b?b(a):'<audio controls="controls" src="'+a.source+'">'+(a.altsource?'\n<source src="'+a.altsource+'"'+(a.altsourcemime?' type="'+a.altsourcemime+'"':"")+" />\n":"")+"</audio>"},va=function(a,b){return b?b(a):'<video width="'+a.width+'" height="'+a.height+'"'+(a.poster?' poster="'+a.poster+'"':"")+' controls="controls">\n<source src="'+a.source+'"'+(a.sourcemime?' type="'+a.sourcemime+'"':"")+" />\n"+(a.altsource?'<source src="'+a.altsource+'"'+(a.altsourcemime?' type="'+a.altsourcemime+'"':"")+" />\n":"")+"</video>"},V=function(a,b){var c=r.extend({},b);if(!c.source&&(r.extend(c,C(w(a),c.embed)),!c.source))return"";c.altsource||(c.altsource="");c.poster||(c.poster="");c.source=a.convertURL(c.source,"source");c.altsource=a.convertURL(c.altsource,"source");c.sourcemime=Q(c.source);c.altsourcemime=Q(c.altsource);c.poster=a.convertURL(c.poster,"poster");if(b=sa(c.source))c.source=b.url,c.type=b.type,c.allowFullscreen=b.allowFullscreen,c.width=c.width||String(b.w),c.height=c.height||String(b.h);if(c.embed)return M(c.embed,c,!0);if(b=L(w(a),c.source))c.type="script",c.width=String(b.width),c.height=String(b.height);b=a.getParam("audio_template_callback");var d=a.getParam("video_template_callback");c.width=c.width||"300";c.height=c.height||"150";r.each(c,function(e,f){c[f]=a.dom.encode(""+e)});return"iframe"===c.type?'<iframe src="'+c.source+'" width="'+c.width+'" height="'+c.height+'"'+(c.allowFullscreen?' allowFullscreen="1"':"")+"></iframe>":"application/x-shockwave-flash"===c.sourcemime?ta(c):-1!==c.sourcemime.indexOf("audio")?ua(c,b):"script"===c.type?'<script src="'+c.source+'">\x3c/script>':va(c,d)},W=tinymce.util.Tools.resolve("tinymce.util.Promise"),D={},wa=function(a,b,c){return new W(function(d,e){var f=function(h){h.html&&(D[a.source]=h);return d({url:a.source,html:h.html?h.html:b(a)})};D[a.source]?f(D[a.source]):c({url:a.source},f,e)})},xa=function(a,b){return new W(function(c){c({html:b(a),url:a.source})})},X=function(a){return function(b){return V(a,b)}},Y=function(a,b){var c=a.getParam("media_url_resolver");return c?wa(b,X(a),c):xa(b,X(a))},ya=function(a,b){return n(b,a).bind(function(c){return n(c,"meta")})},za=function(a,b,c){return function(d){var e,f=function(){return n(b,d)},h=function(l){return n(l,"value").bind(function(m){return 0<m.length?u.some(m):u.none()})},k=function(){return n(a,d).bind(function(l){return N(l)?h(l).orThunk(f):f().orThunk(function(){return u.from(l)})})},g=function(){return f().orThunk(function(){return n(a,d).bind(function(l){return N(l)?h(l):u.from(l)})})};return e={},e[d]=(d===c?k():g()).getOr(""),e}},Aa=function(a,b){var c={};n(a,"dimensions").each(function(d){O(["width","height"],function(e){n(b,e).orThunk(function(){return n(d,e)}).each(function(f){return c[e]=f})})});return c},z=function(a,b){var c=b?ya(b,a).getOr({}):{};b=za(a,c,b);return p(p(p(p(p({},b("source")),b("altsource")),b("poster")),b("embed")),Aa(a,c))},E=function(a){var b=p(p({},a),{source:{value:n(a,"source").getOr("")},altsource:{value:n(a,"altsource").getOr("")},poster:{value:n(a,"poster").getOr("")}});O(["width","height"],function(c){n(a,c).each(function(d){var e=b.dimensions||{};e[c]=d;b.dimensions=e})});return b},Z=function(a){return function(b){a.notificationManager.open({type:"error",text:b&&b.msg?"Media embed handler error: "+b.msg:"Media embed handler threw unknown error."})}},Ba=function(a){var b=a.selection.getNode();b=b.getAttribute("data-mce-object")||b.getAttribute("data-ephox-embed-iri")?a.serializer.serialize(b,{selection:!0}):"";return p({embed:b},C(w(a),b))},aa=function(a,b){return function(c){if(ia(c.url)&&0<c.url.trim().length){var d=c.html;var e=C(w(b),d);c=p(p({},e),{source:c.url,embed:d});a.setData(E(c))}}},ba=function(a,b){var c=a.dom.select("img[data-mce-object]");a.insertContent(b);b=a.dom.select("img[data-mce-object]");for(var d=0;d<c.length;d++)for(var e=b.length-1;0<=e;e--)c[d]===b[e]&&b.splice(e,1);a.selection.select(b[0]);a.nodeChanged()},Ca=function(a,b,c){b.embed=M(b.embed,b);b.embed&&(a.source===b.source||D.hasOwnProperty(b.source))?ba(c,b.embed):Y(c,b).then(function(d){ba(c,d.html)}).catch(Z(c))},ca=function(a){var b=Ba(a),c=I(b);b=E(b);var d=a.getParam("media_dimensions",!0)?[{type:"sizeinput",name:"dimensions",label:"Constrain proportions",constrain:!0}]:[],e={title:"General",name:"general",items:la([[{name:"source",type:"urlinput",filetype:"media",label:"Source"}],d])};d=[];a.getParam("media_alt_source",!0)&&d.push({name:"altsource",type:"urlinput",filetype:"media",label:"Alternative source URL"});a.getParam("media_poster",!0)&&d.push({name:"poster",type:"urlinput",filetype:"image",label:"Media poster (Image URL)"});var f={title:"Advanced",name:"advanced",items:d};e=[e,{title:"Embed",items:[{type:"textarea",name:"embed",label:"Paste your embed code below:"}]}];0<d.length&&e.push(f);var h=a.windowManager.open({title:"Insert/Edit Media",size:"normal",body:{type:"tabpanel",tabs:e},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(k){var g=z(k.getData());Ca(c.get(),g,a);k.close()},onChange:function(k,g){switch(g.name){case"source":g=c.get();var l=z(k.getData(),"source");g.source!==l.source&&(aa(h,a)({url:l.source,html:""}),Y(a,l).then(aa(h,a)).catch(Z(a)));break;case"embed":g=z(k.getData()).embed;g=C(w(a),g);k.setData(E(g));break;case"dimensions":case"altsource":case"poster":g=g.name,g=z(k.getData(),g),l=V(a,g),k.setData(E(p(p({},g),{embed:l})))}c.set(z(k.getData()))},initialData:b})},Da=function(a){return{showDialog:function(){ca(a)}}},Ea=function(a){a.addCommand("mceMedia",function(){ca(a)})},A=tinymce.util.Tools.resolve("tinymce.html.Node");tinymce.util.Tools.resolve("tinymce.Env");var da=function(a,b){if(!1===a.getParam("media_filter_html",!0))return b;var c=S(),d;K({validate:!1,allow_conditional_comments:!1,comment:function(e){c.comment(e)},cdata:function(e){c.cdata(e)},text:function(e,f){c.text(e,f)},start:function(e,f,h){d=!0;if("script"!==e&&"noscript"!==e&&"svg"!==e){for(var k=f.length-1;0<=k;k--){var g=f[k].name;0===g.indexOf("on")&&(delete f.map[g],f.splice(k,1));"style"===g&&(f[k].value=a.dom.serializeStyle(a.dom.parseStyle(f[k].value),e))}c.start(e,f,h);d=!1}},end:function(e){d||c.end(e)}},R({})).parse(b);return c.getContent()},Fa=function(a,b){var c=b.name,d=new A("span",1);d.attr({contentEditable:"false",style:b.attr("style"),"data-mce-object":c,"class":"mce-preview-object mce-object-"+c});var e,f=b.attributes;for(e=f.length;e--;){var h=f[e].name;var k=f[e].value;if("width"!==h&&"height"!==h&&"style"!==h){if("data"===h||"src"===h)k=a.convertURL(k,h);d.attr("data-mce-p-"+h,k)}}if(h=b.firstChild&&b.firstChild.value)d.attr("data-mce-html",escape(da(a,h))),d.firstChild=null;a=new A(c,1);"video"==c?(b.firstChild.value.match(/<source([\s]+|[\s]+[^<>]+[\s]+)src=("([^<>"']*)"|'([^<>"']*)')[^<>]*>/gi),c=RegExp.$3,console.log(c),a.attr({src:c,controls:"",allowfullscreen:b.attr("allowfullscreen"),style:b.attr("style"),class:b.attr("class"),width:b.attr("width"),height:b.attr("height"),frameborder:"0"})):a.attr({src:b.attr("src"),allowfullscreen:b.attr("allowfullscreen"),style:b.attr("style"),class:b.attr("class"),width:b.attr("width"),height:b.attr("height"),frameborder:"0"});b=new A("span",1);b.attr("class","mce-shim");d.append(a);d.append(b);return d},Ga=function(a){return function(b){for(var c=b.length,d,e;c--;)if(d=b[c],d.parent&&!d.parent.attr("data-mce-object")){if("script"===d.name&&(e=L(w(a),d.attr("src")),!e))continue;e&&(e.width&&d.attr("width",e.width.toString()),e.height&&d.attr("height",e.height.toString()));"iframe"===d.name&&a.getParam("media_live_embeds",!0);var f;a:{for(f=d;f=f.parent;){var h;(h=f.attr("data-ephox-embed-iri"))||(h=(h=f.attr("class"))&&/\btiny-pageembed\b/.test(h));if(h){f=!0;break a}}f=!1}f||d.replace(Fa(a,d))}}},Ha=function(a){a.on("preInit",function(){var b=a.schema.getSpecialElements();r.each(["video","audio","iframe","object"],function(d){b[d]=new RegExp("</"+d+"[^>]*>","gi")});var c=a.schema.getBoolAttrs();r.each(["webkitallowfullscreen","mozallowfullscreen","allowfullscreen"],function(d){c[d]={}});a.parser.addNodeFilter("iframe,video,audio,object,embed,script",Ga(a));a.serializer.addAttributeFilter("data-mce-object",function(d,e){for(var f=d.length,h,k,g,l,m;f--;)if(h=d[f],h.parent){m=h.attr(e);k=new A(m,1);"audio"!==m&&"script"!==m&&((g=h.attr("class"))&&-1!==g.indexOf("mce-preview-object")?k.attr({width:h.firstChild.attr("width"),height:h.firstChild.attr("height")}):k.attr({width:h.attr("width"),height:h.attr("height")}));k.attr({style:h.attr("style")});l=h.attributes;for(g=l.length;g--;){var ea=l[g].name;0===ea.indexOf("data-mce-p-")&&k.attr(ea.substr(11),l[g].value)}"script"===m&&k.attr("type","text/javascript");if(m=h.attr("data-mce-html"))g=new A("#text",3),g.raw=!0,g.value=da(a,unescape(m)),k.append(g);h.replace(k)}})});a.on("SetContent",function(){a.$("span.mce-preview-object").each(function(b,c){b=a.$(c);0===b.find("span.mce-shim").length&&b.append('<span class="mce-shim"></span>')})})},Ia=function(a){a.on("ResolveName",function(b){var c;1===b.target.nodeType&&(c=b.target.getAttribute("data-mce-object"))&&(b.name=c)})},Ja=function(a){a.on("click keyup touchend",function(){var b=a.selection.getNode();b&&a.dom.hasClass(b,"mce-preview-object")&&a.dom.getAttrib(b,"data-mce-selected")&&b.setAttribute("data-mce-selected","2")});a.on("ObjectSelected",function(b){var c=b.target.getAttribute("data-mce-object");"audio"!==c&&"script"!==c||b.preventDefault()});a.on("ObjectResized",function(b){var c=b.target,d;c.getAttribute("data-mce-object")&&(d=c.getAttribute("data-mce-html"))&&(d=unescape(d),c.setAttribute("data-mce-html",escape(M(d,{width:String(b.width),height:String(b.height)}))))})},Ka=function(a,b){return function(c){return a.selection.selectorChangedWithUnbind(b.join(","),c.setActive).unbind}},La=function(a){a.ui.registry.addToggleButton("media",{tooltip:"Insert/edit media",icon:"embed",onAction:function(){a.execCommand("mceMedia")},onSetup:Ka(a,["img[data-mce-object]","span[data-mce-object]","div[data-ephox-embed-iri]"])});a.ui.registry.addMenuItem("media",{icon:"embed",text:"Media...",onAction:function(){a.execCommand("mceMedia")}})};(function(){fa.add("media",function(a){Ea(a);La(a);Ia(a);Ha(a);Ja(a);return Da(a)})})()})();